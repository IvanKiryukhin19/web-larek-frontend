# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных используемые в приложении

Карточка
```
export interface ICard {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number|null;
}
```

Пользователь
```
export interface IUser {
  email: string|null;
  phone: string;|null
  address: string|null;
}
```
Интерфейс для моделей данных карточек и корзины, с общими методами
```
export interface ICards {
  setCards(cards:ICard[]):void;
  getCards():ICard[];
  getOneCard(cardId:string):ICard;
}
```
Интерфейс для моделей данных карточек

```
export interface ICardsData extends ICards {
  getPreview():string|null;
  setPreview(cardId:string|null):void;
}
```
Интерфейс для моделей данных карточек корзины
```
export interface IBasketData extends ICards{
  addOneCard(card:ICard):void;
  removeOneCard(cardId:string):void;
  getCountCards():number;
  getSumCards():number;
}
```
Тип для создания свойст класса Пользователя
```
export type TOptionsInfo='address'|'email'|'phone';
```
Тип для выбора способа оплаты
```
export type TOptionPayment='card'|'cash';
```
Интерфейс для модели данных Пользователя
```
export interface IUserData{
  setUserInfo(info:TOptionsInfo, value:string):void;
  setUserBlankInfo():void;
  getUserInfo(info:TOptionsInfo):string|null;
  setPayment(method:TOptionPayment|null):void;
  getPayment():string|null;
  getMessageValidationOrder():string;
  getMessageValidationContacts():string;
}
```
Интерфейс для Api
```
export interface IApiResponseData{
  total:number;
  items:ICard[];
  id:string;
}
```
#### Интерфесы отображения
Интерфейс компонента
```
export interface IViewComponent{
  replaceElementsInContainer:HTMLElement[];
}
```

Интерфейс отображения страницы
```
export interface IPage extends IViewComponent{
  basketOrderCount: number;
}
```
Интерфейс Карточки в HTML разметке 
```
export interface ICardHTML extends Omit<ICard,'price'>, IViewComponent{
  price: string;
  buttonElementTitle:string;
}
```
Интерфейс Корзины
```
export interface IBasket extends IViewComponent{
  button: HTMLButtonElement;
  elementList: HTMLElement;
  sumElement: HTMLElement;
  sumBasket:string;
  basket:HTMLElement;
  isActive:boolean;
}
```
Интерфес Заказа и Контактов
```
export interface IOrder{
  paymentMethod:string|null;
  inputValues:Record<string,string>;
  messageValidation:string|null;
}
```
Интерфейс
```
export interface ISuccess{
  price:string;
  success:HTMLElement;
}
```
Интерфейс модального окна
```
export interface IModal extends IViewComponent {
  open:void;
  close:void;
}
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. 

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события

### Слой данных

#### Класс ModelCardsData
Класс отвечает за хранение данных полученных с сервера\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- cards: ICard[] - массив объектов карточек
- preview: string | null - id карточки, выбранной для просмотра в модальной окне
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при загрузки карточек с сервера и выбора карточки в модальном окне

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- setCards(cards: ICard[]):void - добавляет карточки в модель данных карточек
- getCards(): ICard[] - возвращает все карточки
- getOneCard(cardId: string):ICard - возвращает одну карточку по ее Id
- setPreview(cardId: string | null):void - записывает id карточки, которую надо показать в модальном окне
- getPreview ():string|null - возвращает id карточки, которую надо показать в модальном окне

#### Класс ModelBasket
Класс отвечает за хранение карточек добавленных в корзину\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- cards: ICard[] - для хранения массива объектов карточек
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных в модели корзины (добавление/удаление товара)

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- setCards(cards:ICard[]): void - добавляет карточки в модель данных корзины. По факту в данном приложении используется только для создания пустой корзины или обнуления
- getCards(): ICard[] - получение всех карточек товаров из модели корзины
- getOneCard(cardId: string): ICard - получение одной карточки из модели корзины
- addOneCard(card: ICard): void - добавляет в модель данных корзины одну карточку
- removeOneCard(cardId: string): void - удаляет одну карточку из модели данных корзины
- getCountCards(): number - возвращает количество карточек в моделе данных корзины
- getSumCards(): number - возвращает сумму всех карточек в модели данных корзины

#### Класс ModelUser
Класс отвечает за хранение данных введенных пользователем для оформления заказа\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных в модели Пользователя. Изменение данных в полях для заполнения и выбора способа оплаты
- methodPayment: TOptionPayment|null - для хранения способа оплаты (`card`|`cash`)
- address:string - для хранения данных адреса Пользователя
- email:string - для хранения данных эл.почты Пользователя
- phone:string - для хранения номера телефона Пользователя

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- setUserInfo(info: TOptionsInfo, value: string): void - записывает данные Пользователя в свойста `address`,`email`,`phone`
- setUserBlankInfo():void - очищает свойства `address`,`email`,`phone` в модели данных Пользователя
- getUserInfo(info: TOptionsInfo): string|null -возвращает данные из модели данных Пользователя
- getMessageValidationOrder(): string - возвращает сообщение из модели данных Пользователя о незаполненых элементах способа оплаты и адреса Пользователя
- getMessageValidationContacts(): string - возвращает сообщение из модели данных Пользователя о незаполненых полях почты и телефона Пользователя
- setPayment(method: TOptionPayment): void - записывает в модель данных Пользователя саособ оплаты
- getPayment(): string | null - возвращает из модели данных Пользователя выбранный способ оплаты

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Базовый Класс ViewBaseComponent
Класс является дженериком и родителем всех компонентов слоя представления. В конструктор принимает элемент разметки, являющийся основным родительским контейнером компонента. Содержит метод render, отвечающий за сохранение полученных в параметре данных в полях компонентов через их сеттеры, возвращает обновленный контейнер компонента. Содержит сеттер replaceElementsInContainer для замены елементов контейнера. И метод getContainer - возвращает контейнер.

#### Класс Modal
Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клик оп оверлею и кнопку-крестик для закрытия.
Конструктор принимает элемент-контейнер (элемент модального окна), в котором в разметке страницы будут рендерится превью/корзина/заказ/контакты/успешная оплата.

Поля класса
- events:IEvents - брокер событий
- mainModalWindow:HTMLElement - модальное окно

#### Класс Page
Класс реализиущий отображение всей страницы приложения. Принимает контейнер для отрисовки всех карточек и сеттер для отражения счетчика корзины

Поля класса
- events:IEvents - брокер событий
- basketCount:HTMLElement - элемент для отражения счетчика продуктов в корзине
- basket:HTMLButtonElement - элемент для установления слушателя для окрытия корзины

#### Вспомогательный класс BaseCard
Класс принимает елемент разметки и events, определяет елементы, сеттеры и геттеры которые есть в карточках каталога, превью и корзины. 

Поля класса
- events:IEvents - брокер событий
- elementTitle: HTMLElement - элемент для отображения Названия
- elementPrice: HTMLElement - элемен для отображения Цены товара
- cardId: string; - для Id товара

#### Класс CardCatalog (наследование от BaseCard)
Класс принимает контейнер для отрисовки карточки на странице. Определяет поля для отображения категории товара и картинки

Поля класса
- elementCategory: HTMLElement - поле категории товара
- elementImage: HTMLElement - поле для Изображения товара

#### Класс CardPreview (наследование от CardCatalog)
Класс принимает контейнер для отрисовки карточки в модальном окне. Определяет поля для отображения описания товара и кнопки, с помощью которой товар добавляется в корзину (в модель данных Корзины).
Так как в корзину нельзя добавлять товар больше одного раза - была сделана следующая реализация: назкание кнопки `В корзину` меняется на `Удалить из корзины` c изменением функциональности и наоборот (Изменение функциональности кнопки происходит в слое коммуникации)
Так как карточки товара могут не иметь цены - была выбрана следующая реализация: такой товар нельзя добавить в корзину (в модель данных Корзины) с помощью отключения кнопки. Для информирования пользователя название кнопки меняется на `Бесценна`

Поля класса
- buttonBasket: HTMLElement - кнопка взаимодействия с корзиной (с моделью данных Корзины)
- elementDescription: HTMLElement - поле отображения описания товара

Сеттеры класса
- buttonElementTitle(title:string) - изменяет текст кнопки
- buttonElementDisabled(value:boolean) - отключает/включает кнопку


#### Класс CardBasket (наследование от BaseCard)
Класс принимает контейнер для рендера карточки в корзине. Определяет елементы для порядкового номера товара в корзине и кнопки удаления товара из корзины (из модели данных Корзины через слой коммуникации).

Поля класса
- elementCardIndex: HTMLElement - элемент для порядкового номера
- elementButtonDelete: HTMLButtonElement - элемент-кнопка для удаления товара

Методы
- setCardIndex(value:string) - принимает порядковый номер, тип уже измененный на string

#### Класс BasketForModal
Класс принимает контейнер-список для отображения всех карточек товара. Определяет елементы. Элемент кнопка для отключения кнопки, если ничего не добавлено в корзину и добавления слушателя на нажатие, родительский элемент контейнера - т.к. в модальном окне отображается элемент, который содержит переданный контейнер. Элемент для отображения суммы заказа.

Поля класса
- events: IEvents - брокер событий
- button: HTMLButtonElement - элемент для оключения кнопки
- sumElement: HTMLElement - элемент для отображения суммы товаров
- parentContainer: HTMLElement - родительский контейнер для отображения в модальном окне

Сеттеры
- sumBasket(value:string) - записывает в элемент сумму продуктов
- isActive(value:boolean) - отключает/включает кнопку оформить заказ

Методы
-getContainer() - метод переопределяет унаследованный от ViewBaseComponent, т.к. возвращает не полученный в класс контейнер, а его родителя


#### Вспомогательный класс UserBase
Класс принимает елемент разметки и events, определяет елементы для ввода информации Пользователя, добавляет слушатели с событиями, определяет елемент для вывода сообщения о валидации для форм `order` и `contacts`.

Поля класса
- events:IEvents - брокер событий
- elementsInputs:NodeListOf<HTMLInputElement> - элементы в которых возможен ввод данных Пользователя
- elementButton: HTMLButtonElement - элемент Кнопка для установления атрибута disabled
- elementError: HTMLElement - элемент для вывода сообщения об ошибке валидации

Сеттеры
- inputValues(data: Record<TOptionsInfo, string>) - записывает данные в поля ввода из модели данных Пользователя
- messageValidation(value:string) - записывает данные о валидации в элемент отображения

#### Класс Order (наследование от UserBase)
Класс принимает контейнер и events. Определяет элементы - кнопки способа оплаты. Устанавлявает на них сдушатели. Устанавливает для них стили.
Определяет кнопку для перехода в другое окно.
Вешает на контейнер слушатель на событие `submit`

Поля класса
- elementButton: HTMLButtonElement - элемент для перехода к другому окну оформления
- elementButtonCard: HTMLButtonElement - элемент способа оплаты Картой
- elementButtonCash: HTMLButtonElement - элемент способа оплаты Наличными
- elementsButtons: NodeListOf<HTMLButtonElement> - список кнопок

Сеттеры
- paymentMethod(value:string) - примает название кнопки `cash` или `card`, одной устанавливает стиль `button_alt-active`, другой убирает

#### Класс Contacts (наследование от UserBase)
Класс принимает контейнер и events.
Определяет кнопку для перехода в другое окно.
Вешает на контейнер слушатель на событие `submit`.

#### Класс Success
Класс принимает контейнер и events. Определяет кнопку закрытия модального окна после успешной покупки. Элемент для вывода о списании суммы.

Поля класса
- events:IEvents - брокер событий
- elementButton: HTMLButtonElement - элемент-кнопка для закрытия (новых заказов)
- elementDescription: HTMLElement - элемент для отображения суммы списания

Сеттеры
- price(value:string) - для вывода в элемента окна суммы списания

### Слой коммуникации

#### Класс Api
Принимает в конструктор адресс и опции запроса и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*
- `ModelCardsData:loaded` - данные в модел данных загружены
- `ModelCardsData:selected` - в модель данных внесена запись о карточке для превью
- `ModelBasket:changed` - в модели данных корзины произошло изменение (добавление/удаление)
- `ModalUser:changed` - в модели данных Пользователя произошло изменение. А именно изменился address, email, phone или способ оплаты

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `CardCatalog:click` - нажата карточка на главной странице
- `CardPreview-basket:click` - нажата кнопка отвечающая за добавление товара в корзину (и удаления, если товар уже в корзине)
- `Page-basket:click` - нажали на главной странице на корзину
- `CardBasket:delete` - нажали на кнопку-иконку удалить товар из корзины
- `Basket-order:click` - событие при нажатии на кнопку к оформлению заказа
- `Order-paymentMethod:click` - событие при выборе способа оплаты
- `Order-${name}:input` - событие при внесении данных в поля ввода формы заказа и контактов, где name - название поля ввода
- `Order:submit` - событие если была нажата кнопка для перехода из окна заказа к окну контактов
- `Contacts:submit` - событие для оплаты заказа
- `Success:click` - событие закрытие окна об успешной покупке 

